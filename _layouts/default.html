<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ page.title }} | {{ site.title }}</title>
  <link rel="stylesheet" href="{{ "/assets/css/custom.css" | relative_url }}">
  {% seo %}

  <!-- MathJax -->
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        displayMath: [['$$','$$'], ['\\[','\\]']],
        processEscapes: true,
        packages: { '[+]': ['ams'] },
        macros: {
          bm: ['\\boldsymbol{#1}', 1],
          argmax: '\\operatorname*{arg\\,max}',
          argmin: '\\operatorname*{arg\\,min}'
        }
      },
      chtml: { linebreaks: { automatic: false } },
      options: { skipHtmlTags: ['script','noscript','style','textarea','pre','code'] }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
</head>

<body>
  {% include header.html %}

  <div id="layout">
    <div class="page-wrap">
      <main class="content">
        <!-- ğŸ” ã‚µã‚¤ãƒˆå†…æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ï¼ˆè¨˜äº‹ã®ä¸Šéƒ¨å³å¯„ã›ï¼‰ -->
        <div class="article-tools">
          <span class="last-updated" data-path="{{ page.path | escape }}"></span>
          <div id="search-box">
            <input type="search" id="search-input" placeholder="ã‚µã‚¤ãƒˆå†…æ¤œç´¢â€¦">
            <div id="search-results" hidden></div>
          </div>
        </div>

        <!-- è¨˜äº‹å³ä¸Šã®æœ€çµ‚æ›´æ–°ï¼ˆGitHub APIã§å–å¾—ï¼‰ -->
        <div class="last-updated" data-path="{{ page.path | escape }}"></div>

        {{ content }}
      </main>

      <aside id="toc-side" class="toc-side" aria-label="ãƒšãƒ¼ã‚¸å†…ãƒªãƒ³ã‚¯"></aside>
    </div>
  </div>

  <!-- æœ€çµ‚æ›´æ–°æ—¥æ™‚ã‚’å–å¾—ã—ã¦è¡¨ç¤º -->
  <script>
    (function () {
      const el = document.querySelector('.last-updated');
      if (!el) return;
      const owner = 'Yujingoto';            // â† ãƒªãƒã‚¸ãƒˆãƒªæ‰€æœ‰è€…
      const repo  = 'EEG-Analysis';         // â† ãƒªãƒã‚¸ãƒˆãƒªå
      const path  = el.dataset.path || '';
      if (!path) return;

      const url = `https://api.github.com/repos/${owner}/${repo}/commits?path=${encodeURIComponent(path)}&per_page=1`;
      fetch(url, { headers: { 'Accept': 'application/vnd.github+json' } })
        .then(r => r.ok ? r.json() : Promise.reject())
        .then(data => {
          if (!data || !data[0]) return;
          const d = new Date(data[0].commit.committer.date);
          const txt = d.toLocaleDateString('ja-JP', { year:'numeric', month:'2-digit', day:'2-digit' });
          el.textContent = `æœ€çµ‚æ›´æ–°ï¼š${txt}`;
          el.style.display = 'inline';
        })
        .catch(() => { el.style.display = 'none'; });
    })();
  </script>
  <script src="{{ "/assets/js/toc.js" | relative_url }}" defer></script>
  <script src="{{ "/assets/js/mathwrap.js" | relative_url }}" defer></script>
  <script>
    (function () {
      const input = document.getElementById('search-input');
      const out   = document.getElementById('search-results');
      if (!input || !out) return;

      let DB = [];
      // 1) search.json ã‚’ãƒ­ãƒ¼ãƒ‰
      fetch('{{ "/search.json" | relative_url }}')
        .then(r => { if (!r.ok) throw new Error("fetch failed"); return r.json(); })
        .then(j => { DB = Array.isArray(j) ? j : []; console.log("search.json loaded:", DB.length); })
        .catch(e => { console.error(e); out.hidden = false; out.innerHTML = '<div class="nohit">æ¤œç´¢ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ</div>'; });

      const snippet = (text, q) => {
        const t = (text || '').replace(/\s+/g,' ');
        if (!q) return t.slice(0, 120) + 'â€¦';
        const k = q.toLowerCase(), i = t.toLowerCase().indexOf(k);
        if (i < 0) return t.slice(0, 120) + 'â€¦';
        const s = Math.max(0, i - 40), e = Math.min(t.length, i + k.length + 40);
        return (s ? 'â€¦' : '') + t.slice(s, e) + (e < t.length ? 'â€¦' : '');
      };

      const run = (q) => {
        q = (q || '').trim();
        if (!q) { out.hidden = true; out.innerHTML = ''; return; }
        const terms = q.toLowerCase().split(/\s+/);
        const hits = DB.filter(d => {
          const hay = (d.title + ' ' + d.content).toLowerCase();
          return terms.every(t => hay.includes(t));
        }).slice(0, 20);

        out.innerHTML = hits.length
          ? '<ul class="hits">' + hits.map(d =>
              `<li><a href="${d.url}">${d.title}</a><div class="s">${snippet(d.content, terms[0])}</div></li>`
            ).join('') + '</ul>'
          : '<div class="nohit">è©²å½“ãªã—</div>';
        out.hidden = false;
      };

      let tid = null;
      input.addEventListener('input', () => { clearTimeout(tid); tid = setTimeout(() => run(input.value), 120); });
      input.addEventListener('keydown', e => { if (e.key === 'Enter') { e.preventDefault(); run(input.value); } });
    })();
  </script>

</body>
</html>
