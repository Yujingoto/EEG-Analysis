<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ page.title }} | {{ site.title }}</title>
  <link rel="stylesheet" href="{{ "/assets/css/custom.css" | relative_url }}">
  {% seo %}

  <!-- MathJax -->
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        displayMath: [['$$','$$'], ['\\[','\\]']],
        processEscapes: true,
        packages: { '[+]': ['ams'] },
        macros: {
          bm: ['\\boldsymbol{#1}', 1],
          argmax: '\\operatorname*{arg\\,max}',
          argmin: '\\operatorname*{arg\\,min}'
        }
      },
      chtml: { linebreaks: { automatic: false } },
      options: { skipHtmlTags: ['script','noscript','style','textarea','pre','code'] }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
  <script>
    (() => {
      const $q = document.getElementById('q');
      const $out = document.getElementById('q-result');
      if (!$q || !$out) return;

      let DB = [];
      fetch('{{ "/search.json" | relative_url }}')
        .then(r => r.json()).then(j => DB = j).catch(()=>{});

      const norm = s => (s||"").toLowerCase();
      const makeSnippet = (text, q) => {
        const i = text.indexOf(q);
        if (i < 0) return text.slice(0, 120) + '‚Ä¶';
        const start = Math.max(0, i - 40), end = Math.min(text.length, i + q.length + 40);
        return (start? '‚Ä¶':'') + text.slice(start, end) + (end<text.length? '‚Ä¶':'');
      };

      const search = (q) => {
        if (!q.trim()) { $out.hidden = true; $out.innerHTML = ''; return; }
        const terms = q.trim().toLowerCase().split(/\s+/);
        const hits = DB.filter(d => {
          const hay = (d.title + ' ' + d.content).toLowerCase();
          return terms.every(t => hay.includes(t));
        }).slice(0, 20);

        $out.innerHTML = hits.map(h => `
          <a class="hit" href="${h.url}">
            <div class="t">${h.title}</div>
            <div class="s">${makeSnippet(h.content, terms[0])}</div>
          </a>
        `).join('') || '<div class="nohit">Ë¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü</div>';
        $out.hidden = false;
      };

      let tid; $q.addEventListener('input', () => {
        clearTimeout(tid); tid = setTimeout(() => search($q.value), 120);
      });
    })();
  </script>
</head>

<body>
  {% include header.html %}

  <div id="layout">
    <div class="page-wrap">
      <main class="content">
        <!-- üîç „Çµ„Ç§„ÉàÂÜÖÊ§úÁ¥¢„Éú„ÉÉ„ÇØ„ÇπÔºàË®ò‰∫ã„ÅÆ‰∏äÈÉ®Âè≥ÂØÑ„ÅõÔºâ -->
        <div id="search-box" style="text-align:right; margin-top: 0.5em; margin-bottom: 1em;">
          <input type="text" id="search-input" placeholder="„Çµ„Ç§„ÉàÂÜÖÊ§úÁ¥¢..." 
                style="width: 220px; padding: 4px; font-size: 0.9em;">
          <div id="search-results" 
              style="margin-top: 0.5em; font-size: 0.9em; text-align:left;"></div>
        </div>
        <!-- Ë®ò‰∫ãÂè≥‰∏ä„ÅÆÊúÄÁµÇÊõ¥Êñ∞ÔºàGitHub API„ÅßÂèñÂæóÔºâ -->
        <div class="last-updated" data-path="{{ page.path | escape }}"></div>

        {{ content }}
      </main>

      <aside id="toc-side" class="toc-side" aria-label="„Éö„Éº„Ç∏ÂÜÖ„É™„É≥„ÇØ"></aside>
    </div>
  </div>

  <!-- ÊúÄÁµÇÊõ¥Êñ∞Êó•ÊôÇ„ÇíÂèñÂæó„Åó„Å¶Ë°®Á§∫ -->
  <script>
    (function () {
      const el = document.querySelector('.last-updated');
      if (!el) return;
      const owner = 'Yujingoto';            // ‚Üê „É™„Éù„Ç∏„Éà„É™ÊâÄÊúâËÄÖ
      const repo  = 'EEG-Analysis';         // ‚Üê „É™„Éù„Ç∏„Éà„É™Âêç
      const path  = el.dataset.path || '';
      if (!path) return;

      const url = `https://api.github.com/repos/${owner}/${repo}/commits?path=${encodeURIComponent(path)}&per_page=1`;
      fetch(url, { headers: { 'Accept': 'application/vnd.github+json' } })
        .then(r => r.ok ? r.json() : Promise.reject())
        .then(data => {
          if (!data || !data[0]) return;
          const d = new Date(data[0].commit.committer.date);
          const txt = d.toLocaleDateString('ja-JP', { year:'numeric', month:'2-digit', day:'2-digit' });
          el.textContent = `ÊúÄÁµÇÊõ¥Êñ∞Ôºö${txt}`;
          el.style.display = 'inline';
        })
        .catch(() => { el.style.display = 'none'; });
    })();
  </script>
  <script src="{{ "/assets/js/toc.js" | relative_url }}" defer></script>
  <script src="{{ "/assets/js/mathwrap.js" | relative_url }}" defer></script>
</body>
</html>
