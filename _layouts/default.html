<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ page.title }} | {{ site.title }}</title>
  <link rel="stylesheet" href="{{ "/assets/css/custom.css" | relative_url }}">
  {% seo %}

  <!-- MathJax -->
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        displayMath: [['$$','$$'], ['\\[','\\]']],
        processEscapes: true,
        packages: { '[+]': ['ams'] },
        macros: {
          bm: ['\\boldsymbol{#1}', 1],
          argmax: '\\operatorname*{arg\\,max}',
          argmin: '\\operatorname*{arg\\,min}'
        }
      },
      chtml: { linebreaks: { automatic: false } },
      options: { skipHtmlTags: ['script','noscript','style','textarea','pre','code'] }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
</head>

<body>
  {% include header.html %}

  <div id="layout">
    <div class="page-wrap">
      <main class="content">
        <!-- 🔍 サイト内検索ボックス（記事の上部右寄せ） -->
        <div id="search-box" style="text-align:right; margin-bottom: 1em;">
          <input type="text" id="search-input" placeholder="サイト内検索..." 
                style="width: 220px; padding: 4px; font-size: 0.9em;">
          <div id="search-results" 
              style="margin-top: 0.5em; font-size: 0.9em; text-align:left;"></div>
        </div>
        <!-- 記事右上の最終更新（GitHub APIで取得） -->
        <div class="last-updated" data-path="{{ page.path | escape }}"></div>

        {{ content }}
      </main>

      <aside id="toc-side" class="toc-side" aria-label="ページ内リンク"></aside>
    </div>
  </div>

  <!-- 最終更新日時を取得して表示 -->
  <script>
    (function () {
      const el = document.querySelector('.last-updated');
      if (!el) return;
      const owner = 'Yujingoto';            // ← リポジトリ所有者
      const repo  = 'EEG-Analysis';         // ← リポジトリ名
      const path  = el.dataset.path || '';
      if (!path) return;

      const url = `https://api.github.com/repos/${owner}/${repo}/commits?path=${encodeURIComponent(path)}&per_page=1`;
      fetch(url, { headers: { 'Accept': 'application/vnd.github+json' } })
        .then(r => r.ok ? r.json() : Promise.reject())
        .then(data => {
          if (!data || !data[0]) return;
          const d = new Date(data[0].commit.committer.date);
          const txt = d.toLocaleDateString('ja-JP', { year:'numeric', month:'2-digit', day:'2-digit' });
          el.textContent = `最終更新：${txt}`;
          el.style.display = 'inline';
        })
        .catch(() => { el.style.display = 'none'; });
    })();
  </script>

  <script src="{{ "/assets/js/toc.js" | relative_url }}" defer></script>
  <script src="{{ "/assets/js/mathwrap.js" | relative_url }}" defer></script>
  <script src="{{ "/assets/js/search.js" | relative_url }}" defer></script>
</body>
</html>
